# Sms01206 画面还原分析

> 以桌面版 **Sms01206**（OrderEntryNo / OrderEntryNo_i）为基准，对照 **websms01206** 已实现的画面与跳转，说明哪些画面尚未完全还原、是否需要从 createForm 等拆分，以及画面跳转的修正方案。

---

## 一、Sms01206 与 websms01206 画面对应关系

### 1.1 桌面版 Sms01206 的界面构成

- **主画面**：一个 JApplet 主表单（OrderEntryNo.java），包含：一覧検索条件・結果テーブル、エントリーNo・採番・検索、枝番切替、表頭入力、明細テーブル、追加/更新/削除/クリア/出荷計画/終了 等按钮。
- **弹窗**：全部为独立 CDJDialog 类（ProductDialog、ConsignDialog、RankDecisionDialog、ForwardRequestDialog、OutinDialog、DistributeDialog、DeployDistributeDialog、FactoryNumberDialog、ReplyDialog、TaxDialog、ComformDialog 等），在 Web 版中已对应为 createForm 内的 **modal**（无独立画面）。

结论：**桌面版没有「多个主画面」**，只有 1 个主表单 + 多个对话框。Web 版将「一覧」「新規/編集」「詳細」「登録確認」拆成 5 个页面是合理且已完成的拆分，**无需再从 createForm 拆出更多独立画面**。

### 1.2 websms01206 现有 5 个画面与 URL

| 画面 | URL | 说明 | 还原状态 |
|------|-----|------|----------|
| 一覧 | `GET /websms01206/maintenance/list` | 検索条件 + 結果一覧 + 新規登録/詳細/編集 | ✅ 已有 |
| 新規 | `GET /websms01206/maintenance/create?form` | 採番・入力・追加/更新/削除/クリア/出荷計画/終了 | ✅ 已有 |
| 編集 | `GET /websms01206/maintenance/{entryNo}/update?form` | 同 createForm，带 entryNo 预加载 | ✅ 已有 |
| 詳細 | `GET /websms01206/maintenance/{entryNo}` | 只读表示，編集/一覧に戻る | ✅ 已有 |
| 登録確認 | `GET /websms01206/maintenance/createConfirm` | 確認表示 → 登録実行/修正/戻る | ✅ 已有 |

---

## 二、未完全还原的部分（无需拆画面，需补逻辑与跳转）

### 2.1 画面跳转与数据流

| 问题 | 说明 | 处理 |
|------|------|------|
| **新規/編集 → 登録確認** | 设计上应有「確認」按钮：将 formData 写入 sessionStorage 后跳转 createConfirm；当前 createForm 仅有「追加」（直接 orderInsert），**缺少「確認」按钮**。 | 在 createForm 增加「確認」按钮：校验通过后 sessionStorage.setItem('sms01206_confirmData', JSON.stringify(formData))，再 location 到 createConfirm。 |
| **登録確認「修正」→ 新規フォーム** | 用户点击「修正」应回到 create?form 并**带回已输入数据**。当前 createConfirm 在 onMounted 时已 removeItem('sms01206_confirmData')，且「修正」为普通 &lt;a href="create?form"&gt;，createForm 不读 sessionStorage，导致回到表单后数据丢失。 | ① createConfirm「修正」改为 @click：先将 submitPayload 写回 sessionStorage（key 同上），再 location 到 create?form。② createForm 在 mounted 时若存在 sessionStorage['sms01206_confirmData']，则恢复 formData（或按 ans 格式调用 loadOrderData），然后 removeItem。 |
| **一覧 ↔ 新規/編集/詳細** | 新規登録・詳細・編集 的链接已正确。 | 无需改。 |
| **詳細 → 編集 / 一覧** | 編集・一覧に戻る 链接已正确。 | 无需改。 |
| **登録確認 → 一覧** | 登録実行成功后 location 到 list；戻る 到 list。 | 已正确。 |

### 2.2 功能/校验差异（与画面拆分无关）

- ランク=1 時単価必须、与信判定=8 明細ロック、一覧分页、製品在庫計画按钮、明細コメント 40 字等：参见 `websms01206_vs_Sms01206_全面对比与差距分析.md`，属业务逻辑与校验，不涉及「画面是否拆分」。

---

## 三、画面跳转关系图（修正后）

```
list（一覧）
  ├─ 検索 → api/getOrderSub（前端）
  ├─ 新規登録 → GET create?form
  ├─ 詳細 → GET {entryNo}
  └─ 編集 → GET {entryNo}/update?form

create?form / {entryNo}/update?form（新規/編集）
  ├─ 確認 → sessionStorage 保存 formData → GET createConfirm   ★ 本次追加
  ├─ 追加 → api/orderInsert → 成功时 showAlert
  ├─ 更新/削除/クリア/出荷計画 → 既存
  ├─ 終了 → GET list
  └─ mounted 時 → 若有 sessionStorage['sms01206_confirmData'] 则恢复 formData 并 removeItem   ★ 本次追加

createConfirm（登録確認）
  ├─ 数据来源：sessionStorage（来自 確認）或 entryNo + api/getOrder
  ├─ 登録実行 → api/orderInsert → 成功 → GET list
  ├─ 修正 → sessionStorage 保存 submitPayload → GET create?form   ★ 本次修正
  └─ 戻る → GET list

detail（詳細）
  ├─ 編集 → GET {entryNo}/update?form
  └─ 一覧に戻る → GET list
```

---

## 四、结论

- **无需再拆画面**：Sms01206 的 5 个对应画面（一覧・新規・編集・詳細・登録確認）在 websms01206 中均已存在；桌面版的对话框在 Web 中已作为 createForm 内 modal 实现，无需拆成独立页面。
- **需要补全与修正的**：
  1. createForm：增加「確認」按钮，写入 sessionStorage 后跳转 createConfirm。
  2. createForm：mounted 时从 sessionStorage 恢复「修正」回来的数据。
  3. createConfirm：「修正」点击时写回 sessionStorage 再跳转 create?form。

以上修正后，画面与跳转即可与 Sms01206 设计一致并完整还原。
